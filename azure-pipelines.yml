parameters:
  - name: env
    displayName: 'Environment'
    default: prod
    type: string
    values:
      - dev
      - prod

  - name: browser
    displayName: 'Browser'
    default: chrome
    type: string
    values:
      - chrome
      - firefox
      - edge
      - electron

trigger:
  - main

pool:
  vmImage: ubuntu-latest

variables:
  LANG: en_US.UTF-8
  LC_ALL: en_US.UTF-8

steps:
  - task: NodeTool@0
    inputs:
      versionSource: 'spec'
      versionSpec: '20.x'
    displayName: 'Install Node.js'

  - script: npm install
    displayName: 'Install dependencies'

  - script: npm run test-${{parameters.env}} -- --browser ${{parameters.browser}}
    displayName: 'Run tests'
    continueOnError: true

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: 'cypress/results/output.txt'
      ArtifactName: 'output'
      publishLocation: 'Container'
    displayName: 'Publish artifacts'
    continueOnError: true

  - task: PublishTestResults@2
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: '**/cypress/results/junitreport.xml'
    displayName: 'Publish JUnit report'

  - task: PublishHtmlReport@1
    inputs:
      reportDir: 'cypress/results/index.html'
    displayName: 'Publish HTML report'
